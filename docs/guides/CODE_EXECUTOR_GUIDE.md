# ๐ ุฏููู ุชูููุฐ ุงูููุฏ (Code Executor)

## ๐ ุงูููุฏูุฉ

ูุธุงู **Code Executor** ูู Oqool Code ูุชูุญ ูู:
- โถ๏ธ **ุชุดุบูู ุงูุฃููุงุฏ** ูุจุงุดุฑุฉ (JavaScript, TypeScript, Python)
- ๐ก๏ธ **Sandbox Mode** ูุชุดุบูู ุขูู
- ๐ง **Auto-fix** ููุฃุฎุทุงุก ุจุงุณุชุฎุฏุงู AI
- โฑ๏ธ **Timeout Protection** ูููุน ุงูุชุดุบูู ุงููุงููุงุฆู
- ๐ **ุชุญููู ุงูุฃุฎุทุงุก** ูุงูุฅุตูุงุญ ุงูุฐูู

---

## ๐ ุงูุงุณุชุฎุฏุงู ุงูุณุฑูุน

### 1๏ธโฃ ุชุดุบูู ููู ููุฏ

```bash
oqool-code run <file>
```

**ูุซุงู:**
```bash
oqool-code run src/app.js
```

---

### 2๏ธโฃ ุชุดุบูู ูุน ุฎูุงุฑุงุช

```bash
# ูุน Sandbox
oqool-code run src/app.js --sandbox

# ูุน Timeout ูุฎุตุต (ุจุงููููู ุซุงููุฉ)
oqool-code run src/app.js --timeout 10000

# ูุน ูุนุงููุงุช
oqool-code run src/script.js --args arg1 arg2 arg3
```

---

### 3๏ธโฃ ุฅุตูุงุญ ุฎุทุฃ ุชููุงุฆูุงู

```bash
oqool-code fix <file> --auto-apply
```

**ูุซุงู:**
```bash
oqool-code fix src/api.js --auto-apply
```

**ุจุฏูู ุชุทุจูู (ูุนุงููุฉ ููุท):**
```bash
oqool-code fix src/api.js
```

---

### 4๏ธโฃ ุชุดุบูู ูุฅุตูุงุญ ุชููุงุฆู

```bash
oqool-code run-fix <file>
```

**ูุซุงู:**
```bash
oqool-code run-fix src/app.js
```

ูุฐุง ุงูุฃูุฑ:
1. โ ูุดุบู ุงูููุฏ
2. โ ุฅุฐุง ูุดู โ ูุญูู ุงูุฎุทุฃ
3. ๐ง ูุตูุญู ุชููุงุฆูุงู
4. โ ูุดุบูู ูุฑุฉ ุฃุฎุฑู

---

## ๐ ุงููุบุงุช ุงููุฏุนููุฉ

| ุงููุบุฉ | ุงูุงูุชุฏุงุฏ | ุงููููุณุฑ ุงููุณุชุฎุฏู |
|-------|----------|------------------|
| JavaScript | `.js`, `.mjs` | `node` |
| TypeScript | `.ts` | `npx ts-node` |
| Python | `.py` | `python3` |

---

## ๐ก๏ธ ูุถุน Sandbox

Sandbox ูููุฑ ุจูุฆุฉ ุชุดุบูู ูุนุฒููุฉ:

```bash
oqool-code run script.js --sandbox
```

**ูุงุฐุง ูุญุฏุซ ูู Sandboxุ**
- ๐ ุชุนููู `NODE_ENV=sandbox`
- ๐ ุจูุฆุฉ ูุนุฒููุฉ ุนู ุงููุธุงู
- ๐ ูุซุงูู ูุชุดุบูู ุฃููุงุฏ ุบูุฑ ููุซููุฉ

---

## โฑ๏ธ Timeout Protection

ุชุญุฏูุฏ ููุช ุฃูุตู ููุชุดุบูู:

```bash
# ุชููู ุจุนุฏ 10 ุซูุงูู
oqool-code run longScript.js --timeout 10000
```

**ุงูุงูุชุฑุงุถู:** 5000ms (5 ุซูุงูู)

ุฅุฐุง ุชุฌุงูุฒ ุงูููุฏ ูุฐุง ุงูููุช:
```
โ ุชุฌุงูุฒ ุงูููุช ุงููุญุฏุฏ (10000ms)
```

---

## ๐ง ูุธุงู Auto-fix

### ููู ูุนููุ

1. **ุชุดุบูู ุงูููุฏ** โ ูุดู
2. **ุชุญููู ุงูุฎุทุฃ**:
   - ููุน ุงูุฎุทุฃ (Syntax, Runtime, etc.)
   - ุฑูู ุงูุณุทุฑ
   - Stack trace
3. **ุฅุฑุณุงู ููู AI**:
   - ูุญุชูู ุงูููู
   - ุงูุฎุทุฃ
   - ุชุญููู AST
4. **ุงุณุชุฎุฑุงุฌ ุงูุญู**:
   - PATCH operations
   - ุฃู Full file rewrite
5. **ุชุทุจูู ุงูุชุนุฏููุงุช**
6. **ุงุฎุชุจุงุฑ ุงูุญู**
7. **ุฅุนุงุฏุฉ ุงููุญุงููุฉ** (ุญุชู 3 ูุฑุงุช)

---

## ๐ ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฏุนููุฉ

### 1. **Syntax Errors**

```javascript
// ุฎุทุฃ: ููุณ ููููุฏ
function test() {
  console.log('Hello'
// โ ููุณ )  ููููุฏ
```

**Auto-fix ููุชุดู:**
```
โ SyntaxError: Unexpected end of input
๐ก ุงูุฎุทุฃ ูู ุงูุณุทุฑ: 3
```

---

### 2. **Runtime Errors**

```javascript
// ุฎุทุฃ: ูุชุบูุฑ ุบูุฑ ูุนุฑู
function greet() {
  console.log(userName);  // โ userName ุบูุฑ ูุนุฑู
}
greet();
```

**Auto-fix ููุชุดู:**
```
โ ReferenceError: userName is not defined
๐ก ุงูุฎุทุฃ ูู ุงูุณุทุฑ: 3
```

---

### 3. **Type Errors**

```javascript
// ุฎุทุฃ: ุงุณุชุฏุนุงุก ุฏุงูุฉ ุบูุฑ ููุฌูุฏุฉ
const obj = { name: 'Test' };
obj.getName();  // โ getName ุบูุฑ ููุฌูุฏุฉ
```

**Auto-fix ููุชุดู:**
```
โ TypeError: obj.getName is not a function
๐ก ุงูุฎุทุฃ ูู ุงูุณุทุฑ: 2
```

---

## ๐ฏ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุดุบูู ุจุณูุท

**ุงูููู: hello.js**
```javascript
console.log('Hello, World!');
```

**ุงูุฃูุฑ:**
```bash
oqool-code run hello.js
```

**ุงููุชูุฌุฉ:**
```
๐ค ุงููุฎุฑุฌุงุช:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Hello, World!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุฌุญ ุงูุชูููุฐ! (45ms)
```

---

### ูุซุงู 2: ุชุดุบูู ูุน ูุนุงููุงุช

**ุงูููู: greet.js**
```javascript
const name = process.argv[2] || 'Guest';
console.log(`Hello, ${name}!`);
```

**ุงูุฃูุฑ:**
```bash
oqool-code run greet.js --args Ahmed
```

**ุงููุชูุฌุฉ:**
```
๐ค ุงููุฎุฑุฌุงุช:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Hello, Ahmed!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุฌุญ ุงูุชูููุฐ! (52ms)
```

---

### ูุซุงู 3: ุฎุทุฃ ูุฅุตูุงุญ ุชููุงุฆู

**ุงูููู: buggy.js**
```javascript
function add(a, b) {
  return a + b;
}

console.log(add(5, notDefined));  // โ ุฎุทุฃ
```

**ุงูุฃูุฑ:**
```bash
oqool-code run-fix buggy.js
```

**ุงููุชูุฌุฉ:**
```
๐ ุชุดุบูู buggy.js...

โ ูุดู ุงูุชูููุฐ!

โ๏ธ  ุงูุฎุทุฃ:
ReferenceError: notDefined is not defined

๐ง ูุญุงููุฉ ุฅุตูุงุญ ุงูุฎุทุฃ ูู buggy.js...

๐ ูุญุงููุฉ 1 ูู 3...

๐ค ุฌุงุฑู ุชุญููู ุงูุฎุทุฃ ูุฅูุฌุงุฏ ุงูุญู...

โ ุชู ุฅูุฌุงุฏ ุงูุญู!

๐ ุงูุดุฑุญ:
ุงููุชุบูุฑ notDefined ุบูุฑ ูุนุฑู. ูุจุฏู ุฃูู ุฎุทุฃ ูู ุงููุชุงุจุฉ...

๐ ุชุทุจูู 1 patch(es)...

โ ุชู ุชุทุจูู ุงูุชุนุฏููุงุช

๐งช ุงุฎุชุจุงุฑ ุงูุญู...

โ ูุฌุญ ุงูุฅุตูุงุญ! ุงูููุฏ ูุนูู ุงูุขู ุจุดูู ุตุญูุญ

๐ค ุงููุฎุฑุฌุงุช ุงูููุงุฆูุฉ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
13
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ูุซุงู 4: Sandbox Mode

**ุงูููู: risky.js**
```javascript
// ููุฏ ูุฏ ูููู ุฎุทุฑ
console.log('Running in:', process.env.NODE_ENV);
console.log('Safe execution!');
```

**ุงูุฃูุฑ:**
```bash
oqool-code run risky.js --sandbox
```

**ุงููุชูุฌุฉ:**
```
๐ค ุงููุฎุฑุฌุงุช:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Running in: sandbox
Safe execution!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุฌุญ ุงูุชูููุฐ! (68ms)
```

---

### ูุซุงู 5: Timeout Protection

**ุงูููู: infinite.js**
```javascript
// ุญููุฉ ูุง ููุงุฆูุฉ
while (true) {
  console.log('Running...');
}
```

**ุงูุฃูุฑ:**
```bash
oqool-code run infinite.js --timeout 2000
```

**ุงููุชูุฌุฉ:**
```
โ ุงูุฎุทุฃ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุชุฌุงูุฒ ุงูููุช ุงููุญุฏุฏ (2000ms)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ก ุฌุฑุจ: oqool-code fix infinite.js --auto-apply
```

---

## โ๏ธ ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ

### ุฃูุฑ `run`

| ุงูุฎูุงุฑ | ุงููุตู | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|--------|-------|-------------------|
| `-t, --timeout <ms>` | ููุช ุงูุชูุงุก ุงูุชูููุฐ | 5000 |
| `--sandbox` | ุชุดุบูู ูู ูุถุน sandbox | false |
| `--args <args...>` | ูุนุงููุงุช ููุจุฑูุงูุฌ | [] |

---

### ุฃูุฑ `fix`

| ุงูุฎูุงุฑ | ุงููุตู | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|--------|-------|-------------------|
| `-m, --max-attempts <n>` | ุนุฏุฏ ูุญุงููุงุช ุงูุฅุตูุงุญ | 3 |
| `--auto-apply` | ุชุทุจูู ุงูุชุนุฏููุงุช ุชููุงุฆูุงู | false |

---

### ุฃูุฑ `run-fix`

| ุงูุฎูุงุฑ | ุงููุตู | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|--------|-------|-------------------|
| `-t, --timeout <ms>` | ููุช ุงูุชูุงุก ุงูุชูููุฐ | 5000 |
| `-m, --max-attempts <n>` | ุนุฏุฏ ูุญุงููุงุช ุงูุฅุตูุงุญ | 3 |
| `--no-auto-apply` | ุนุฏู ุงูุชุทุจูู ุงูุชููุงุฆู | false |

---

## ๐ง API ูููุทูุฑูู

```typescript
import { createCodeExecutor } from '@oqool/code';

const executor = createCodeExecutor();

// 1. ุชุดุบูู ุงูููุฏ
const result = await executor.executeCode({
  file: 'src/app.js',
  env: 'sandbox',
  timeout: 5000,
  args: ['arg1', 'arg2']
});

if (result.success) {
  console.log('Output:', result.output);
  console.log('Runtime:', result.runtime, 'ms');
} else {
  console.error('Error:', result.error);
  console.error('Type:', result.errorType);
  console.error('Line:', result.errorLine);
}

// 2. ุฅุตูุงุญ ุฎุทุฃ
const fixResult = await executor.fixError({
  file: 'src/app.js',
  error: result.error,
  errorType: result.errorType,
  maxAttempts: 3,
  autoApply: true
});

if (fixResult.fixed) {
  console.log('Fixed!');
}

// 3. ุชุดุบูู ูุฅุตูุงุญ ุชููุงุฆู
const finalResult = await executor.runAndFix('src/app.js', {
  timeout: 5000,
  autoApply: true,
  maxAttempts: 3
});
```

---

## ๐ ExecutionResult Interface

```typescript
interface ExecutionResult {
  success: boolean;          // ูุฌุญ ุงูุชูููุฐุ
  output?: string;           // ุงููุฎุฑุฌุงุช
  error?: string;            // ุฑุณุงูุฉ ุงูุฎุทุฃ
  exitCode?: number;         // ููุฏ ุงูุฎุฑูุฌ
  runtime?: number;          // ููุช ุงูุชูููุฐ (ms)
  errorType?: 'syntax' | 'runtime' | 'timeout' | 'other';
  errorLine?: number;        // ุฑูู ุงูุณุทุฑ
  errorStack?: string;       // Stack trace
}
```

---

## ๐ FixResult Interface

```typescript
interface FixResult {
  success: boolean;          // ูุฌุญุช ุงูุนูููุฉุ
  fixed: boolean;            // ุชู ุงูุฅุตูุงุญุ
  message: string;           // ุฑุณุงูุฉ ุงูุญุงูุฉ
  attempts: number;          // ุนุฏุฏ ุงููุญุงููุงุช
  patches?: any[];           // ุงูุชุนุฏููุงุช ุงููุทุจูุฉ
}
```

---

## ๐ก ูุตุงุฆุญ

### 1. ุงุณุชุฎุฏู Sandbox ููุฃููุงุฏ ุบูุฑ ุงูููุซููุฉ

```bash
# โ ุขูู
oqool-code run untrusted-script.js --sandbox

# โ๏ธ ุฎุทุฑ
oqool-code run untrusted-script.js
```

---

### 2. ุญุฏุฏ Timeout ููุงุณุจ

```bash
# ููุฃููุงุฏ ุงูุณุฑูุนุฉ
oqool-code run quick.js --timeout 1000

# ููุฃููุงุฏ ุงูุซูููุฉ
oqool-code run heavy.js --timeout 30000
```

---

### 3. ุงุณุชุฎุฏู run-fix ููุฅูุชุงุฌูุฉ

ุจุฏูุงู ูู:
```bash
oqool-code run app.js
# ูุดู
oqool-code fix app.js --auto-apply
oqool-code run app.js
```

ุงุณุชุฎุฏู:
```bash
oqool-code run-fix app.js
```

---

### 4. ูุนุงููุฉ ูุจู ุงูุชุทุจูู

```bash
# ูุนุงููุฉ ุงูุญู
oqool-code fix app.js

# ุฅุฐุง ูุงู ุงูุญู ุตุญูุญุ ุทุจูู
oqool-code fix app.js --auto-apply
```

---

## ๐ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### 1. **ุงุฎุชุจุงุฑ ุณุฑูุน**

```bash
# ุงุฎุชุจุฑ ููุฏ ุณุฑูุน
oqool-code run test.js
```

---

### 2. **ุงูุชุทููุฑ**

```bash
# ุดุบู ูุฃุตูุญ ุชููุงุฆูุงู ุฃุซูุงุก ุงูุชุทููุฑ
oqool-code run-fix src/app.js
```

---

### 3. **CI/CD**

```bash
# ุงุฎุชุจุฑ ุงูุฃููุงุฏ ูู CI
oqool-code run tests/*.js --timeout 10000
```

---

### 4. **ุชุดุบูู Scripts**

```bash
# ุดุบู script ูุน ูุนุงููุงุช
oqool-code run scripts/build.js --args production
```

---

## ๐ ุงูุชูุงูู ูุน ุงูููุฒุงุช ุงูุฃุฎุฑู

### ูุน AST Analyzer

```bash
# ุญูู ุงูููุฏ ูุจู ุงูุชุดุบูู
oqool-code analyze src/app.js

# ุซู ุดุบูู
oqool-code run src/app.js
```

---

### ูุน Patch System

```bash
# ุนุฏู ุงูููุฏ
oqool-code patch "ุญุณู ุฃุฏุงุก ุงูุฏุงูุฉ" --files src/app.js

# ุซู ุดุบูู
oqool-code run src/app.js
```

---

## โ๏ธ ูุชุทูุจุงุช

### ูู TypeScript:

```bash
npm install -g ts-node
```

### ูู Python:

```bash
# ุชุฃูุฏ ูู ุชุซุจูุช Python 3
python3 --version
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: ts-node ุบูุฑ ูุซุจุช

```bash
npm install -g ts-node
```

---

### ุฎุทุฃ: python3 ุบูุฑ ููุฌูุฏ

```bash
# ุนูู Ubuntu/Debian
sudo apt install python3

# ุนูู macOS
brew install python3
```

---

### ุฎุทุฃ: ุงูููู ุบูุฑ ููุฌูุฏ

ุชุฃูุฏ ูู ุงููุณุงุฑ:
```bash
# โ ุตุญูุญ
oqool-code run src/app.js

# โ ุฎุทุฃ
oqool-code run app.js  # ุฅุฐุง ูุงู ูู src/
```

---

## ๐ ุงููุฑุงุฌุน

- [README.md](README.md)
- [PATCH_GUIDE.md](PATCH_GUIDE.md)
- [AST_ANALYZER_GUIDE.md](AST_ANALYZER_GUIDE.md)
- [code-executor.ts](src/code-executor.ts)

---

**ุตููุน ุจู โค๏ธ ุจูุงุณุทุฉ Oqool AI Team**
